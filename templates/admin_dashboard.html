<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Excellence Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-gray-50" x-data="adminDashboard()" x-init="init()">
    <!-- Top Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <i class="fas fa-graduation-cap text-3xl text-indigo-600 mr-3"></i>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">Admin Dashboard</h1>
                        <p class="text-xs text-gray-600" x-text="settings.school_name"></p>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <div class="text-right hidden md:block">
                        <p class="text-sm font-medium text-gray-900" x-text="user.first_name + ' ' + user.last_name">
                        </p>
                        <p class="text-xs text-gray-600">Administrator</p>
                    </div>
                    <div class="bg-indigo-600 text-white rounded-full w-10 h-10 flex items-center justify-center">
                        <span
                            x-text="user.first_name ? user.first_name.charAt(0) + user.last_name.charAt(0) : 'A'"></span>
                    </div>
                    <button @click="logout()" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-lg overflow-y-auto">
            <nav class="mt-5 px-2">
                <a @click="currentView = 'overview'"
                    :class="currentView === 'overview' ? 'bg-indigo-50 text-indigo-600' : 'text-gray-600 hover:bg-gray-50'"
                    class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg cursor-pointer mb-1">
                    <i class="fas fa-home mr-3"></i> Overview
                </a>

                <a @click="currentView = 'applications'"
                    :class="currentView === 'applications' ? 'bg-indigo-50 text-indigo-600' : 'text-gray-600 hover:bg-gray-50'"
                    class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg cursor-pointer mb-1">
                    <i class="fas fa-file-alt mr-3"></i> Applications
                    <span x-show="stats.applications?.pending_review > 0"
                        class="ml-auto bg-red-500 text-white text-xs rounded-full px-2 py-1"
                        x-text="stats.applications?.pending_review"></span>
                </a>

                <a @click="currentView = 'students'"
                    :class="currentView === 'students' ? 'bg-indigo-50 text-indigo-600' : 'text-gray-600 hover:bg-gray-50'"
                    class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg cursor-pointer mb-1">
                    <i class="fas fa-user-graduate mr-3"></i> Students
                </a>

                <a @click="currentView = 'teachers'"
                    :class="currentView === 'teachers' ? 'bg-indigo-50 text-indigo-600' : 'text-gray-600 hover:bg-gray-50'"
                    class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg cursor-pointer mb-1">
                    <i class="fas fa-chalkboard-teacher mr-3"></i> Teachers
                </a>

                <a @click="currentView = 'classes'"
                    :class="currentView === 'classes' ? 'bg-indigo-50 text-indigo-600' : 'text-gray-600 hover:bg-gray-50'"
                    class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg cursor-pointer mb-1">
                    <i class="fas fa-school mr-3"></i> Classes
                </a>

                <a @click="currentView = 'finance'"
                    :class="currentView === 'finance' ? 'bg-indigo-50 text-indigo-600' : 'text-gray-600 hover:bg-gray-50'"
                    class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg cursor-pointer mb-1">
                    <i class="fas fa-money-bill-wave mr-3"></i> Finance
                </a>

                <a @click="currentView = 'reports'"
                    :class="currentView === 'reports' ? 'bg-indigo-50 text-indigo-600' : 'text-gray-600 hover:bg-gray-50'"
                    class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg cursor-pointer mb-1">
                    <i class="fas fa-chart-bar mr-3"></i> Reports
                </a>

                <a @click="currentView = 'timetable'"
                    :class="currentView === 'timetable' ? 'bg-indigo-50 text-indigo-600' : 'text-gray-600 hover:bg-gray-50'"
                    class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg cursor-pointer mb-1">
                    <i class="fas fa-calendar-alt mr-3"></i> Timetable
                </a>

                <a @click="currentView = 'settings'"
                    :class="currentView === 'settings' ? 'bg-indigo-50 text-indigo-600' : 'text-gray-600 hover:bg-gray-50'"
                    class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg cursor-pointer mb-1">
                    <i class="fas fa-cog mr-3"></i> Settings
                </a>

                <div class="border-t border-gray-200 my-4"></div>

                <a href="/admin/" target="_blank"
                    class="group flex items-center px-4 py-3 text-sm font-medium text-gray-600 hover:bg-gray-50 rounded-lg cursor-pointer mb-1">
                    <i class="fas fa-database mr-3"></i> Django Admin
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto bg-gray-50 p-6">
            <!-- Loading State -->
            <div x-show="loading" class="flex items-center justify-center h-64">
                <div class="text-center">
                    <i class="fas fa-spinner fa-spin text-4xl text-indigo-600 mb-4"></i>
                    <p class="text-gray-600">Loading dashboard...</p>
                </div>
            </div>

            <!-- Overview Section -->
            <div x-show="currentView === 'overview' && !loading">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Dashboard Overview</h2>
                    <p class="text-gray-600">Welcome back! Here's what's happening today.</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Total Students</p>
                                <p class="text-3xl font-bold text-gray-900"
                                    x-text="stats.students?.total_enrolled || 0"></p>
                                <p class="text-sm text-green-600 mt-1">
                                    <i class="fas fa-arrow-up"></i>
                                    <span x-text="stats.students?.new_admissions || 0"></span> this month
                                </p>
                            </div>
                            <div class="bg-blue-100 rounded-full p-4">
                                <i class="fas fa-user-graduate text-blue-600 text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Pending Applications</p>
                                <p class="text-3xl font-bold text-gray-900"
                                    x-text="stats.applications?.pending_review || 0"></p>
                                <p class="text-sm text-orange-600 mt-1">
                                    <span x-text="stats.applications?.total_received || 0"></span> total received
                                </p>
                            </div>
                            <div class="bg-orange-100 rounded-full p-4">
                                <i class="fas fa-file-alt text-orange-600 text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Total Teachers</p>
                                <p class="text-3xl font-bold text-gray-900"
                                    x-text="stats.user_statistics?.teachers || 0"></p>
                                <p class="text-sm text-gray-600 mt-1">Active faculty</p>
                            </div>
                            <div class="bg-green-100 rounded-full p-4">
                                <i class="fas fa-chalkboard-teacher text-green-600 text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Collection Rate</p>
                                <p class="text-3xl font-bold text-gray-900"
                                    x-text="(stats.financial?.collection_rate || 0) + '%'"></p>
                                <p class="text-sm text-gray-600 mt-1">
                                    GHS <span
                                        x-text="(stats.financial?.application_fees_collected || 0).toFixed(2)"></span>
                                </p>
                            </div>
                            <div class="bg-purple-100 rounded-full p-4">
                                <i class="fas fa-money-bill-wave text-purple-600 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Application Status</h3>
                        <canvas id="applicationsChart"></canvas>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Class Capacity</h3>
                        <canvas id="classCapacityChart"></canvas>
                    </div>
                </div>

                <!-- Quick Actions & Recent Applications -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                        <div class="space-y-3">
                            <template x-for="action in stats.quick_actions" :key="action.title">
                                <div @click="handleQuickAction(action)"
                                    class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                    <div class="flex items-center">
                                        <i :class="action.icon" class="text-indigo-600 mr-3"></i>
                                        <div>
                                            <p class="font-medium text-gray-900" x-text="action.title"></p>
                                            <p class="text-sm text-gray-600" x-text="action.count + ' pending'"></p>
                                        </div>
                                    </div>
                                    <span :class="{
                                        'bg-red-100 text-red-800': action.priority === 'high',
                                        'bg-yellow-100 text-yellow-800': action.priority === 'medium'
                                    }" class="px-3 py-1 rounded-full text-xs font-medium"
                                        x-text="action.priority.toUpperCase()"></span>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Applications</h3>
                        <div class="space-y-3">
                            <template x-for="app in stats.recent_applications?.slice(0, 5)"
                                :key="app.application_number">
                                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                                    <div>
                                        <p class="font-medium text-gray-900" x-text="app.name"></p>
                                        <p class="text-sm text-gray-600" x-text="app.applying_for"></p>
                                    </div>
                                    <span :class="{
                                        'bg-green-100 text-green-800': app.status === 'accepted',
                                        'bg-yellow-100 text-yellow-800': app.status === 'submitted' || app.status === 'pending',
                                        'bg-blue-100 text-blue-800': app.status === 'under_review',
                                        'bg-red-100 text-red-800': app.status === 'rejected'
                                    }" class="px-3 py-1 rounded-full text-xs font-medium"
                                        x-text="app.status.replace('_', ' ').toUpperCase()"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Applications Section with FIXED Accept Button -->
            <div x-show="currentView === 'applications' && !loading">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Applications Management</h2>
                        <p class="text-gray-600">Review and process student applications</p>
                    </div>
                    <button @click="loadApplications()"
                        class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow mb-6">
                    <div class="border-b border-gray-200">
                        <nav class="flex space-x-8 px-6" aria-label="Tabs">
                            <template x-for="tab in applicationTabs" :key="tab.key">
                                <button @click="activeApplicationTab = tab.key"
                                    :class="activeApplicationTab === tab.key ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                    class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                                    <span x-text="tab.label"></span>
                                    <span x-show="tab.count > 0"
                                        :class="activeApplicationTab === tab.key ? 'bg-indigo-100 text-indigo-600' : 'bg-gray-100 text-gray-600'"
                                        class="ml-2 py-0.5 px-2.5 rounded-full text-xs font-medium"
                                        x-text="tab.count"></span>
                                </button>
                            </template>
                        </nav>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                        Application #</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                        Applicant</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Class
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                        Submitted</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="app in filteredApplications" :key="app.application_number">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
                                            x-text="app.application_number"></td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900" x-text="app.learner_name">
                                            </div>
                                            <div class="text-sm text-gray-500" x-text="app.parent_email || ''"></div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                                            x-text="app.applying_for_class"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                                            x-text="formatDate(app.submitted_at)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span :class="{
                                                'bg-green-100 text-green-800': app.status === 'accepted',
                                                'bg-yellow-100 text-yellow-800': app.status === 'pending',
                                                'bg-blue-100 text-blue-800': app.status === 'under_review',
                                                'bg-purple-100 text-purple-800': app.status === 'exam_completed',
                                                'bg-red-100 text-red-800': app.status === 'rejected'
                                            }" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                                x-text="app.status.replace('_', ' ').toUpperCase()"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button @click="viewApplication(app)"
                                                class="text-indigo-600 hover:text-indigo-900 mr-3" title="View">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <!-- FIXED: Works for pending AND exam_completed -->
                                            <button x-show="['pending', 'exam_completed'].includes(app.status)"
                                                @click="acceptApplication(app)"
                                                class="text-green-600 hover:text-green-900 mr-3"
                                                title="Accept & Enroll">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button
                                                x-show="['pending', 'under_review', 'exam_completed'].includes(app.status)"
                                                @click="rejectApplication(app)" class="text-red-600 hover:text-red-900"
                                                title="Reject">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Students Management Section -->
            <div x-show="currentView === 'students' && !loading">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Students Management</h2>
                        <p class="text-gray-600">View and manage student records</p>
                    </div>
                    <button @click="showAddStudent = true"
                        class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                        <i class="fas fa-plus mr-2"></i>Add New Student
                    </button>
                </div>

                <!-- Students Filter -->
                <div class="bg-white rounded-lg shadow p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <input type="text" x-model="studentSearch" @input="filterStudents()"
                            placeholder="Search students..."
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        <select x-model="studentClassFilter" @change="filterStudents()"
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <option value="">All Classes</option>
                            <template x-for="cls in availableClasses" :key="cls.id">
                                <option :value="cls.id" x-text="cls.name"></option>
                            </template>
                        </select>
                        <select x-model="studentStatusFilter" @change="filterStudents()"
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <option value="active">Active</option>
                            <option value="">All Status</option>
                            <option value="inactive">Inactive</option>
                        </select>
                        <button @click="loadStudents()"
                            class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
                            <i class="fas fa-filter mr-2"></i>Apply Filters
                        </button>
                    </div>
                </div>

                <!-- Students Table -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Class</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Parent</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Attendance
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <template x-for="student in filteredStudents" :key="student.id">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm" x-text="student.student_id"></td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900" x-text="student.name"></div>
                                        <div class="text-sm text-gray-500" x-text="student.email"></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm" x-text="student.class"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <div x-text="student.parent_name"></div>
                                        <div class="text-gray-500" x-text="student.parent_contact"></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="text-sm font-medium text-green-600"
                                            x-text="student.attendance_rate + '%'"></span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button @click="viewStudent(student)"
                                            class="text-indigo-600 hover:text-indigo-900 mr-3" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button @click="editStudent(student)"
                                            class="text-blue-600 hover:text-blue-900 mr-3" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Teachers Management Section (keeping your existing working code) -->
            <div x-show="currentView === 'teachers' && !loading">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Teachers Management</h2>
                        <p class="text-gray-600">Add, view, and manage teaching staff</p>
                    </div>
                    <button @click="showAddTeacher = true"
                        class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                        <i class="fas fa-plus mr-2"></i>Add New Teacher
                    </button>
                </div>

                <div x-show="teachers.length === 0" class="bg-white rounded-lg shadow p-12 text-center">
                    <i class="fas fa-chalkboard-teacher text-gray-300 text-6xl mb-4"></i>
                    <p class="text-gray-500 text-lg">No teachers added yet</p>
                    <button @click="showAddTeacher = true"
                        class="mt-4 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                        Add Your First Teacher
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <template x-for="teacher in teachers" :key="teacher.id">
                        <div class="bg-white rounded-lg shadow hover:shadow-lg transition p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="bg-indigo-100 rounded-full w-16 h-16 flex items-center justify-center">
                                    <span class="text-2xl font-bold text-indigo-600"
                                        x-text="teacher.first_name.charAt(0) + teacher.last_name.charAt(0)"></span>
                                </div>
                                <div class="flex space-x-2">
                                    <button @click="editTeacher(teacher)" class="text-blue-600 hover:text-blue-800"
                                        title="Edit">
                                        <i class="fas fa-edit text-lg"></i>
                                    </button>
                                    <button @click="deleteTeacher(teacher.id)" class="text-red-600 hover:text-red-800"
                                        title="Delete">
                                        <i class="fas fa-trash text-lg"></i>
                                    </button>
                                </div>
                            </div>

                            <h3 class="text-lg font-bold text-gray-900 mb-1" x-text="teacher.full_name"></h3>
                            <p class="text-sm text-gray-600 mb-3" x-text="teacher.email"></p>

                            <div class="space-y-2 text-sm mb-4">
                                <div class="flex items-center">
                                    <i class="fas fa-phone text-gray-400 w-5"></i>
                                    <span class="text-gray-700" x-text="teacher.phone || 'No phone'"></span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-school text-gray-400 w-5"></i>
                                    <span class="text-gray-700" x-text="teacher.total_classes + ' classes'"></span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-user-graduate text-gray-400 w-5"></i>
                                    <span class="text-gray-700" x-text="teacher.total_students + ' students'"></span>
                                </div>
                            </div>

                            <div class="border-t pt-3">
                                <p class="text-xs text-gray-500 mb-2">Subjects:</p>
                                <div class="flex flex-wrap gap-1">
                                    <template x-for="subject in teacher.subjects" :key="subject">
                                        <span class="px-2 py-1 bg-indigo-50 text-indigo-700 rounded text-xs"
                                            x-text="subject"></span>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Add/Edit Teacher Modal -->
                <div x-show="showAddTeacher" x-cloak
                    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
                    @click.self="showAddTeacher = false">
                    <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="p-6 border-b flex justify-between items-center">
                            <h3 class="text-xl font-bold text-gray-900">Add New Teacher</h3>
                            <button @click="showAddTeacher = false; resetTeacherForm()"
                                class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <form @submit.prevent="saveTeacher()" class="p-6">
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                                        <input type="text" x-model="newTeacher.first_name" required
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                                        <input type="text" x-model="newTeacher.last_name" required
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                                        <input type="email" x-model="newTeacher.email" required
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                                        <input type="tel" x-model="newTeacher.phone"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Subjects to Teach
                                        *</label>
                                    <div class="border border-gray-300 rounded-lg p-3 max-h-48 overflow-y-auto">
                                        <template x-for="subject in availableSubjects" :key="subject.id">
                                            <label
                                                class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                                <input type="checkbox" :value="subject.id" x-model="newTeacher.subjects"
                                                    class="mr-3 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                                <span class="text-sm"
                                                    x-text="subject.name + ' (' + subject.code + ')'"></span>
                                            </label>
                                        </template>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Classes to Teach
                                        *</label>
                                    <div class="border border-gray-300 rounded-lg p-3 max-h-48 overflow-y-auto">
                                        <template x-for="cls in availableClasses" :key="cls.id">
                                            <label
                                                class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                                <input type="checkbox" :value="cls.id" x-model="newTeacher.classes"
                                                    class="mr-3 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                                <span class="text-sm" x-text="cls.name"></span>
                                            </label>
                                        </template>
                                    </div>
                                </div>

                                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                                    <p class="text-sm text-yellow-800">
                                        <i class="fas fa-info-circle mr-2"></i>
                                        A temporary password will be generated and displayed after creation.
                                    </p>
                                </div>
                            </div>

                            <div class="mt-6 flex justify-end space-x-3">
                                <button type="button" @click="showAddTeacher = false; resetTeacherForm()"
                                    class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                    Cancel
                                </button>
                                <button type="submit" :disabled="savingTeacher"
                                    class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50">
                                    <span x-show="!savingTeacher">Add Teacher</span>
                                    <span x-show="savingTeacher">
                                        <i class="fas fa-spinner fa-spin mr-2"></i>Adding...
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Classes Management Section -->
            <div x-show="currentView === 'classes' && !loading">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Class Management</h2>
                        <p class="text-gray-600">Manage classes, capacity, and assignments</p>
                    </div>
                    <button @click="showCreateClass = true"
                        class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                        <i class="fas fa-plus mr-2"></i>Create New Class
                    </button>
                </div>

                <!-- Classes Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <template x-for="cls in classes" :key="cls.id">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900" x-text="cls.name"></h3>
                                    <p class="text-sm text-gray-600" x-text="cls.class_teacher || 'No Class Teacher'">
                                    </p>
                                </div>
                                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">
                                    <span x-text="cls.is_active ? 'Active' : 'Inactive'"></span>
                                </span>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="text-gray-600">Capacity</span>
                                        <span class="font-medium" x-text="cls.enrolled + '/' + cls.capacity"></span>
                                    </div>
                                    <div class="bg-gray-200 rounded-full h-2">
                                        <div class="bg-indigo-600 h-2 rounded-full"
                                            :style="'width: ' + (cls.enrolled/cls.capacity*100) + '%'"></div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <p class="text-gray-600">Avg Attendance</p>
                                        <p class="font-semibold text-green-600" x-text="cls.avg_attendance + '%'"></p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600">Available</p>
                                        <p class="font-semibold text-blue-600" x-text="cls.available"></p>
                                    </div>
                                </div>
                            </div>
                            <button @click="viewClassStudents(cls)"
                                class="w-full mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                                <i class="fas fa-users mr-2"></i>View Students
                            </button>
                        </div>
                    </template>
                </div>

                <!-- Create Class Modal -->
                <div x-show="showCreateClass" x-cloak
                    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
                    @click.self="showCreateClass = false">
                    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4">
                        <div class="p-6 border-b flex justify-between items-center">
                            <h3 class="text-xl font-bold text-gray-900">Create New Class</h3>
                            <button @click="showCreateClass = false" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <form @submit.prevent="createClass()" class="p-6">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Class Name *</label>
                                    <input type="text" x-model="newClass.name" required placeholder="e.g., Grade 6-A"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Capacity *</label>
                                    <input type="number" x-model="newClass.capacity" required min="1" value="50"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Academic Year *</label>
                                    <input type="text" x-model="newClass.academic_year" required placeholder="2024-2025"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>

                            <div class="mt-6 flex justify-end space-x-3">
                                <button type="button" @click="showCreateClass = false"
                                    class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                    Cancel
                                </button>
                                <button type="submit" :disabled="savingClass"
                                    class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50">
                                    <span x-show="!savingClass">Create Class</span>
                                    <span x-show="savingClass">
                                        <i class="fas fa-spinner fa-spin mr-2"></i>Creating...
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Finance Management Section -->
            <div x-show="currentView === 'finance' && !loading">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Finance Management</h2>
                    <p class="text-gray-600">Track fees, payments, and financial reports</p>
                </div>

                <!-- Financial Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <p class="text-sm text-gray-600">Total Revenue</p>
                        <p class="text-2xl font-bold text-gray-900">GHS <span
                                x-text="(financeData.total_revenue || 0).toFixed(2)"></span></p>
                        <p class="text-sm text-green-600 mt-1">
                            <i class="fas fa-arrow-up"></i> From collected fees
                        </p>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <p class="text-sm text-gray-600">Pending Fees</p>
                        <p class="text-2xl font-bold text-orange-600">GHS <span
                                x-text="(financeData.pending_fees || 0).toFixed(2)"></span></p>
                        <p class="text-sm text-gray-600 mt-1" x-text="financeData.students_with_pending + ' students'">
                        </p>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <p class="text-sm text-gray-600">This Month Collection</p>
                        <p class="text-2xl font-bold text-green-600">GHS <span
                                x-text="(financeData.monthly_collection || 0).toFixed(2)"></span></p>
                        <p class="text-sm text-gray-600 mt-1" x-text="financeData.collection_rate + '% rate'"></p>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <p class="text-sm text-gray-600">Overdue Amount</p>
                        <p class="text-2xl font-bold text-red-600">GHS <span
                                x-text="(financeData.overdue_amount || 0).toFixed(2)"></span></p>
                        <p class="text-sm text-gray-600 mt-1">Overdue payments</p>
                    </div>
                </div>

                <!-- Record Payment & View Pending -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Record Payment Form -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Record Payment</h3>
                        <form @submit.prevent="recordPayment()">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Student ID *</label>
                                    <input type="text" x-model="payment.student_id" required placeholder="STU-2024-0001"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Amount (GHS) *</label>
                                    <input type="number" x-model="payment.amount" required step="0.01" min="0"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Payment Method *</label>
                                    <select x-model="payment.payment_method" required
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                        <option value="cash">Cash</option>
                                        <option value="bank_transfer">Bank Transfer</option>
                                        <option value="mobile_money">Mobile Money</option>
                                        <option value="cheque">Cheque</option>
                                        <option value="card">Card</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Reference Number</label>
                                    <input type="text" x-model="payment.reference" placeholder="Optional"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>

                                <button type="submit" :disabled="processingPayment"
                                    class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50">
                                    <span x-show="!processingPayment">Record Payment</span>
                                    <span x-show="processingPayment">
                                        <i class="fas fa-spinner fa-spin mr-2"></i>Processing...
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Pending Fees Students -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Students with Pending Fees</h3>
                            <button @click="loadPendingFees()" class="text-indigo-600 hover:text-indigo-800">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            <template x-for="student in pendingFeeStudents" :key="student.student_id">
                                <div class="border border-gray-200 rounded-lg p-3">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="font-medium text-gray-900" x-text="student.name"></p>
                                            <p class="text-sm text-gray-600"
                                                x-text="student.student_id + ' - ' + student.class"></p>
                                        </div>
                                        <span :class="{
                                            'bg-red-100 text-red-800': student.is_overdue,
                                            'bg-orange-100 text-orange-800': !student.is_overdue
                                        }" class="px-2 py-1 rounded-full text-xs font-medium"
                                            x-text="student.is_overdue ? 'OVERDUE' : 'PENDING'"></span>
                                    </div>
                                    <div class="mt-2 text-sm">
                                        <p class="text-gray-600">Balance: <span class="font-bold text-red-600">GHS <span
                                                    x-text="student.balance.toFixed(2)"></span></span></p>
                                        <p class="text-gray-500">Due: <span
                                                x-text="formatDate(student.due_date)"></span></p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div x-show="currentView === 'reports' && !loading">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Reports & Analytics</h2>
                    <p class="text-gray-600">Comprehensive school performance reports</p>
                </div>

                <!-- Report Categories -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="bg-blue-100 rounded-full w-12 h-12 flex items-center justify-center mb-4">
                            <i class="fas fa-chart-line text-blue-600 text-xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Academic Performance</h3>
                        <p class="text-sm text-gray-600 mb-4">Class-wise and student performance analysis</p>
                        <button @click="generateReport('academic')"
                            class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            <i class="fas fa-download mr-2"></i>Generate Report
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="bg-green-100 rounded-full w-12 h-12 flex items-center justify-center mb-4">
                            <i class="fas fa-calendar-check text-green-600 text-xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Attendance Reports</h3>
                        <p class="text-sm text-gray-600 mb-4">Daily, weekly, and monthly attendance data</p>
                        <button @click="generateReport('attendance')"
                            class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            <i class="fas fa-download mr-2"></i>Generate Report
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="bg-purple-100 rounded-full w-12 h-12 flex items-center justify-center mb-4">
                            <i class="fas fa-money-bill text-purple-600 text-xl"></i>
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-2">Financial Reports</h3>
                        <p class="text-sm text-gray-600 mb-4">Revenue, expenses, and fee collection</p>
                        <button @click="generateReport('financial')"
                            class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            <i class="fas fa-download mr-2"></i>Generate Report
                        </button>
                    </div>
                </div>

                <!-- Teacher Performance -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Teacher Performance Overview</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Teacher
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Classes
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                        Attendances Marked</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                        Performance</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="teacher in teacherPerformance" :key="teacher.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900" x-text="teacher.name"></div>
                                            <div class="text-sm text-gray-500" x-text="teacher.email"></div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm"
                                            x-text="teacher.classes_assigned"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm"
                                            x-text="teacher.attendances_marked"></td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <template x-for="i in 5" :key="i">
                                                    <i
                                                        :class="i <= teacher.performance_score ? 'fas fa-star text-yellow-400' : 'far fa-star text-gray-300'"></i>
                                                </template>
                                                <span class="ml-2 text-sm text-gray-600"
                                                    x-text="teacher.performance_score.toFixed(1)"></span>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div x-show="currentView === 'timetable' && !loading">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Timetable Management</h2>
                    <p class="text-gray-600">Create and manage class schedules</p>
                </div>

                <!-- Class Selector -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select Class</label>
                            <select x-model="selectedTimetableClass" @change="loadTimetable()"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <option value="">-- Select a Class --</option>
                                <template x-for="cls in classes" :key="cls.id">
                                    <option :value="cls.id" x-text="cls.name"></option>
                                </template>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button x-show="selectedTimetableClass" @click="showAddTimetableEntry = true"
                                class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 w-full">
                                <i class="fas fa-plus mr-2"></i>Add Timetable Entry
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Timetable Display -->
                <div x-show="selectedTimetableClass" class="bg-white rounded-lg shadow overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Day</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Time</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Subject</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Teacher</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Room</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <template x-for="entry in timetableEntries" :key="entry.id">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium"
                                        x-text="entry.day_of_week"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm" x-text="entry.time_slot"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm" x-text="entry.subject_name"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm" x-text="entry.teacher_name"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm" x-text="entry.room_number || '-'">
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm space-x-2">
                                        <button @click="editTimetableEntry(entry)"
                                            class="text-blue-600 hover:text-blue-900">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button @click="deleteTimetableEntry(entry.id)"
                                            class="text-red-600 hover:text-red-900">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </template>
                            <tr x-show="timetableEntries.length === 0">
                                <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                    <i class="fas fa-calendar-times text-4xl mb-2 block"></i>
                                    No timetable entries yet. Add your first entry above.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Add/Edit Timetable Entry Modal -->
                <div x-show="showAddTimetableEntry" x-cloak
                    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
                    @click.self="showAddTimetableEntry = false">
                    <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="p-6 border-b flex justify-between items-center">
                            <h3 class="text-xl font-bold text-gray-900">
                                <span x-text="editingTimetableEntry ? 'Edit' : 'Add'"></span> Timetable Entry
                            </h3>
                            <button @click="showAddTimetableEntry = false; resetTimetableForm()"
                                class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <form @submit.prevent="saveTimetableEntry()" class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Day of Week -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Day of Week *</label>
                                    <select x-model="newTimetableEntry.day_of_week" required
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                        <option value="">-- Select Day --</option>
                                        <option value="Monday">Monday</option>
                                        <option value="Tuesday">Tuesday</option>
                                        <option value="Wednesday">Wednesday</option>
                                        <option value="Thursday">Thursday</option>
                                        <option value="Friday">Friday</option>
                                    </select>
                                </div>

                                <!-- Time Slot -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Time Slot *</label>
                                    <select x-model="newTimetableEntry.time_slot" required
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                        <option value="">-- Select Time --</option>
                                        <option value="08:00-09:00">08:00 - 09:00</option>
                                        <option value="09:00-10:00">09:00 - 10:00</option>
                                        <option value="10:00-11:00">10:00 - 11:00</option>
                                        <option value="11:00-12:00">11:00 - 12:00</option>
                                        <option value="12:00-13:00">12:00 - 13:00 (Lunch)</option>
                                        <option value="13:00-14:00">13:00 - 14:00</option>
                                        <option value="14:00-15:00">14:00 - 15:00</option>
                                        <option value="15:00-16:00">15:00 - 16:00</option>
                                    </select>
                                </div>

                                <!-- Subject -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Subject *</label>
                                    <select x-model="newTimetableEntry.subject_id" required
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                        <option value="">-- Select Subject --</option>
                                        <template x-for="subject in availableSubjects" :key="subject.id">
                                            <option :value="subject.id"
                                                x-text="subject.name + ' (' + subject.code + ')'"></option>
                                        </template>
                                    </select>
                                </div>

                                <!-- Teacher -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Teacher *</label>
                                    <select x-model="newTimetableEntry.teacher_id" required
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                        <option value="">-- Select Teacher --</option>
                                        <template x-for="teacher in teachers" :key="teacher.id">
                                            <option :value="teacher.id" x-text="teacher.full_name"></option>
                                        </template>
                                    </select>
                                    <p class="text-xs text-gray-500 mt-1">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        Only teachers in the system can be assigned
                                    </p>
                                </div>

                                <!-- Room Number -->
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Room Number</label>
                                    <input type="text" x-model="newTimetableEntry.room_number"
                                        placeholder="e.g., Room 101"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>

                            <div class="mt-6 flex justify-end space-x-3">
                                <button type="button" @click="showAddTimetableEntry = false; resetTimetableForm()"
                                    class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                    Cancel
                                </button>
                                <button type="submit" :disabled="savingTimetable"
                                    class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50">
                                    <span x-show="!savingTimetable">
                                        <span x-text="editingTimetableEntry ? 'Update' : 'Add'"></span> Entry
                                    </span>
                                    <span x-show="savingTimetable">
                                        <i class="fas fa-spinner fa-spin mr-2"></i>Saving...
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Empty State -->
                <div x-show="!selectedTimetableClass" class="bg-white rounded-lg shadow p-12 text-center">
                    <i class="fas fa-calendar-alt text-gray-300 text-6xl mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Select a Class</h3>
                    <p class="text-gray-500">Choose a class above to view or manage its timetable</p>
                </div>
            </div>


            <!-- Settings Section -->
            <div x-show="currentView === 'settings' && !loading">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">System Settings</h2>
                    <p class="text-gray-600">Configure school information and system preferences</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- School Information -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">School Information</h3>
                        <form @submit.prevent="saveSchoolSettings()">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">School Name</label>
                                    <input type="text" x-model="settings.school_name"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">School Email</label>
                                    <input type="email" x-model="settings.school_email"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Contact Number</label>
                                    <input type="tel" x-model="settings.school_phone"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                                    <textarea rows="3" x-model="settings.school_address"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"></textarea>
                                </div>
                                <button type="submit" :disabled="savingSettings"
                                    class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50">
                                    <span x-show="!savingSettings"><i class="fas fa-save mr-2"></i>Save Changes</span>
                                    <span x-show="savingSettings"><i
                                            class="fas fa-spinner fa-spin mr-2"></i>Saving...</span>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Academic Settings -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Academic Settings</h3>
                        <form @submit.prevent="saveAcademicSettings()">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Current Academic
                                        Year</label>
                                    <input type="text" x-model="settings.current_academic_year" placeholder="2024-2025"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Current Term</label>
                                    <select x-model="settings.current_term"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                        <option value="first">First Term</option>
                                        <option value="second">Second Term</option>
                                        <option value="third">Third Term</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Grading System</label>
                                    <select x-model="settings.grading_system"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                        <option value="percentage">Percentage (0-100)</option>
                                        <option value="letter">Letter Grade (A-F)</option>
                                        <option value="gpa">GPA (0-4.0)</option>
                                    </select>
                                </div>
                                <button type="submit" :disabled="savingSettings"
                                    class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50">
                                    <span x-show="!savingSettings"><i class="fas fa-save mr-2"></i>Save Changes</span>
                                    <span x-show="savingSettings"><i
                                            class="fas fa-spinner fa-spin mr-2"></i>Saving...</span>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- User Roles & Permissions -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">User Roles & Permissions</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-900">Super Admin</p>
                                    <p class="text-sm text-gray-600">Full system access</p>
                                </div>
                                <span
                                    class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium">Critical</span>
                            </div>
                            <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-900">Admin</p>
                                    <p class="text-sm text-gray-600">Most management functions</p>
                                </div>
                                <button class="text-indigo-600 hover:text-indigo-800 text-sm">
                                    <i class="fas fa-edit mr-1"></i>Configure
                                </button>
                            </div>
                            <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-900">Headmaster</p>
                                    <p class="text-sm text-gray-600">View all data, limited editing</p>
                                </div>
                                <button class="text-indigo-600 hover:text-indigo-800 text-sm">
                                    <i class="fas fa-edit mr-1"></i>Configure
                                </button>
                            </div>
                            <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-900">Teacher</p>
                                    <p class="text-sm text-gray-600">Class management only</p>
                                </div>
                                <button class="text-indigo-600 hover:text-indigo-800 text-sm">
                                    <i class="fas fa-edit mr-1"></i>Configure
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Student Details Modal -->
    <div x-show="showStudentModal" x-cloak
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
        @click.self="showStudentModal = false">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold text-gray-900">Student Details</h3>
                <button @click="showStudentModal = false" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div class="p-6" x-show="selectedStudent">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-3">Personal Information</h4>
                        <div class="space-y-2">
                            <p class="text-sm"><span class="font-medium">Student ID:</span> <span
                                    x-text="selectedStudent?.student_id"></span></p>
                            <p class="text-sm"><span class="font-medium">Name:</span> <span
                                    x-text="selectedStudent?.name"></span></p>
                            <p class="text-sm"><span class="font-medium">Email:</span> <span
                                    x-text="selectedStudent?.email"></span></p>
                            <p class="text-sm"><span class="font-medium">Class:</span> <span
                                    x-text="selectedStudent?.class"></span></p>
                            <p class="text-sm"><span class="font-medium">Roll Number:</span> <span
                                    x-text="selectedStudent?.roll_number"></span></p>
                            <p class="text-sm"><span class="font-medium">Date of Birth:</span> <span
                                    x-text="selectedStudent?.date_of_birth"></span></p>
                            <p class="text-sm"><span class="font-medium">Blood Group:</span> <span
                                    x-text="selectedStudent?.blood_group"></span></p>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-semibold text-gray-900 mb-3">Parent/Guardian Information</h4>
                        <div class="space-y-2">
                            <p class="text-sm"><span class="font-medium">Name:</span> <span
                                    x-text="selectedStudent?.parent_name"></span></p>
                            <p class="text-sm"><span class="font-medium">Contact:</span> <span
                                    x-text="selectedStudent?.parent_contact"></span></p>
                        </div>

                        <h4 class="font-semibold text-gray-900 mb-3 mt-6">Health Information</h4>
                        <div class="space-y-2">
                            <p class="text-sm"><span class="font-medium">Allergies:</span> <span
                                    x-text="selectedStudent?.allergies"></span></p>
                            <p class="text-sm"><span class="font-medium">Address:</span> <span
                                    x-text="selectedStudent?.address"></span></p>
                        </div>
                    </div>

                    <div class="col-span-2">
                        <h4 class="font-semibold text-gray-900 mb-3">Academic Performance</h4>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="text-sm text-gray-600">Attendance Rate</p>
                                <p class="text-2xl font-bold text-blue-600"
                                    x-text="selectedStudent?.attendance_rate + '%'"></p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <p class="text-sm text-gray-600">Average Grade</p>
                                <p class="text-2xl font-bold text-green-600"
                                    x-text="selectedStudent?.average_grade + '%'"></p>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <p class="text-sm text-gray-600">Status</p>
                                <p class="text-2xl font-bold text-purple-600" x-text="selectedStudent?.status"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function adminDashboard() {
            return {
                user: {},
                currentView: 'overview',
                loading: true,
                stats: {},

                // Applications
                applications: [],
                activeApplicationTab: 'all',
                applicationTabs: [
                    { key: 'all', label: 'All', count: 0 },
                    { key: 'pending', label: 'Pending', count: 0 },
                    { key: 'under_review', label: 'Under Review', count: 0 },
                    { key: 'exam_completed', label: 'Exam Completed', count: 0 },
                    { key: 'accepted', label: 'Accepted', count: 0 },
                    { key: 'rejected', label: 'Rejected', count: 0 }
                ],

                // Students
                students: [],
                filteredStudents: [],
                studentSearch: '',
                studentClassFilter: '',
                studentStatusFilter: 'active',
                showStudentModal: false,
                selectedStudent: null,
                showAddStudent: false,

                // Teachers
                teachers: [],
                showAddTeacher: false,
                savingTeacher: false,
                availableSubjects: [],
                availableClasses: [],
                newTeacher: {
                    first_name: '',
                    last_name: '',
                    email: '',
                    phone: '',
                    subjects: [],
                    classes: []
                },

                // Classes
                classes: [],
                showCreateClass: false,
                savingClass: false,
                newClass: {
                    name: '',
                    capacity: 50,
                    academic_year: '2024-2025'
                },

                // Finance
                financeData: {},
                pendingFeeStudents: [],
                payment: {
                    student_id: '',
                    amount: '',
                    payment_method: 'cash',
                    reference: ''
                },
                processingPayment: false,

                selectedTimetableClass: null,
                timetableEntries: [],
                showAddTimetableEntry: false,
                editingTimetableEntry: null,
                savingTimetable: false,
                newTimetableEntry: {
                    day_of_week: '',
                    time_slot: '' ,
                    subject_id: '',
                    teacher_id: '',
                    room_number: ''
                },

                // Methods
                // CORRECTED TIMETABLE FUNCTIONS FOR YOUR ADMIN DASHBOARD
                // Replace the timetable-related functions in your adminDashboard() with these:

                // Load timetable for selected class
                async loadTimetable() {
                    if (!this.selectedTimetableClass) {
                        this.timetableEntries = [];
                        return;
                    }

                    try {
                        console.log('🔄 Loading timetable for class:', this.selectedTimetableClass);

                        const response = await fetch(`/api/v1/dashboard/admin/timetable/class/${this.selectedTimetableClass}/`, {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });

                        const data = await response.json();
                        console.log('📥 Timetable response:', data);

                        if (data.success) {
                            // The backend returns entries in data.data.entries
                            this.timetableEntries = data.data.entries || [];
                            console.log('✅ Loaded', this.timetableEntries.length, 'timetable entries');
                        } else {
                            console.error('❌ Failed to load timetable:', data.error);
                            this.timetableEntries = [];
                        }
                    } catch (error) {
                        console.error('❌ Error loading timetable:', error);
                        alert('Failed to load timetable. Check console for details.');
                        this.timetableEntries = [];
                    }
                },

                // Save timetable entry (create or update)
                async saveTimetableEntry() {
                    // Validation
                    if (!this.newTimetableEntry.day_of_week || !this.newTimetableEntry.time_slot ||
                        !this.newTimetableEntry.subject_id || !this.newTimetableEntry.teacher_id) {
                        alert('Please fill in all required fields:\n- Day of Week\n- Time Slot\n- Subject\n- Teacher');
                        return;
                    }

                    if (!this.selectedTimetableClass) {
                        alert('Please select a class first');
                        return;
                    }

                    this.savingTimetable = true;

                    try {
                        console.log('💾 Saving timetable entry...');
                        console.log('Data:', {
                            class_id: this.selectedTimetableClass,
                            ...this.newTimetableEntry
                        });

                        // Use single endpoint for both create and update
                        const url = '/api/v1/dashboard/admin/timetable/entry/';
                        const method = 'POST';

                        const requestBody = {
                            class_id: this.selectedTimetableClass,
                            day_of_week: this.newTimetableEntry.day_of_week,
                            time_slot: this.newTimetableEntry.time_slot,
                            subject_id: this.newTimetableEntry.subject_id,
                            teacher_id: this.newTimetableEntry.teacher_id,
                            room_number: this.newTimetableEntry.room_number || ''
                        };

                        // If editing, include the entry ID
                        if (this.editingTimetableEntry) {
                            requestBody.id = this.editingTimetableEntry.id;
                        }

                        const response = await fetch(url, {
                            method: method,
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(requestBody)
                        });

                        const data = await response.json();
                        console.log('📥 Save response:', data);

                        if (data.success) {
                            alert(this.editingTimetableEntry ?
                                '✅ Timetable entry updated successfully!' :
                                '✅ Timetable entry added successfully!');

                            this.showAddTimetableEntry = false;
                            this.resetTimetableForm();
                            await this.loadTimetable();
                        } else {
                            alert('❌ Error: ' + (data.error || 'Failed to save timetable entry'));
                            console.error('Save error details:', data);
                        }
                    } catch (error) {
                        console.error('❌ Network error saving timetable entry:', error);
                        alert('Network error: Could not save timetable entry. Check console for details.');
                    } finally {
                        this.savingTimetable = false;
                    }
                },

                // Edit timetable entry
                editTimetableEntry(entry) {
                    console.log('✏️ Editing entry:', entry);

                    this.editingTimetableEntry = entry;

                    // Populate the form with entry data
                    this.newTimetableEntry = {
                        day_of_week: entry.day_of_week,
                        time_slot: entry.time_slot_name || entry.time_slot,
                        subject_id: entry.subject_id,
                        teacher_id: entry.teacher_id,
                        room_number: entry.room_number || ''
                    };

                    this.showAddTimetableEntry = true;
                },

                // Delete timetable entry
                async deleteTimetableEntry(entryId) {
                    if (!confirm('⚠️ Are you sure you want to delete this timetable entry?')) {
                        return;
                    }

                    try {
                        console.log('🗑️ Deleting entry:', entryId);

                        const response = await fetch(`/api/v1/dashboard/admin/timetable/entry/${entryId}/`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });

                        const data = await response.json();
                        console.log('📥 Delete response:', data);

                        if (data.success) {
                            alert('✅ Timetable entry deleted successfully!');
                            await this.loadTimetable();
                        } else {
                            alert('❌ Error: ' + (data.error || 'Failed to delete entry'));
                        }
                    } catch (error) {
                        console.error('❌ Error deleting entry:', error);
                        alert('Network error: Could not delete entry. Check console for details.');
                    }
                },

                // Reset timetable form
                resetTimetableForm() {
                    this.editingTimetableEntry = null;
                    this.newTimetableEntry = {
                        day_of_week: '',
                        time_slot: '',
                        subject_id: '',
                        teacher_id: '',
                        room_number: ''
                    };
                },
                // Reports
                teacherPerformance: [],

                // Settings
                settings: {
                    school_name: 'Excellence Academy',
                    school_email: '',
                    school_phone: '',
                    school_address: '',
                    current_academic_year: '2024-2025',
                    current_term: 'first',
                    grading_system: 'percentage'
                },
                savingSettings: false,

                async init() {
                    const token = localStorage.getItem('access_token');
                    const userData = localStorage.getItem('user_data');

                    if (!token || !userData) {
                        alert('Please login first');
                        window.location.href = '/auth/';
                        return;
                    }

                    this.user = JSON.parse(userData);

                    try {
                        const response = await fetch('/api/v1/dashboard/verify-admin/', {
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });

                        const data = await response.json();

                        if (!data.success) {
                            alert('Access Denied: Admin privileges required');
                            window.location.href = '/auth/';
                            return;
                        }

                        await Promise.all([
                            this.loadDashboardData(),
                            this.loadApplications(),
                            this.loadStudents(),
                            this.loadTeachers(),
                            this.loadClasses(),
                            this.loadFinanceData(),
                            this.loadTeacherPerformance(),
                            this.loadSettings(),
                            this.loadAvailableData()
                        ]);

                        this.$nextTick(() => this.initCharts());

                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error loading dashboard');
                    } finally {
                        this.loading = false;
                    }
                },

                async loadDashboardData() {
                    try {
                        const response = await fetch('/api/v1/dashboard/admin/overview/', {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.stats = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading dashboard:', error);
                    }
                },

                async loadApplications() {
                    try {
                        const response = await fetch('/api/v1/admin/admissions/applications/', {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.applications = data.data.applications;
                            this.updateApplicationTabs();
                        }
                    } catch (error) {
                        console.error('Error loading applications:', error);
                    }
                },

                updateApplicationTabs() {
                    this.applicationTabs[0].count = this.applications.length;
                    this.applicationTabs[1].count = this.applications.filter(a => a.status === 'pending').length;
                    this.applicationTabs[2].count = this.applications.filter(a => a.status === 'under_review').length;
                    this.applicationTabs[3].count = this.applications.filter(a => a.status === 'exam_completed').length;
                    this.applicationTabs[4].count = this.applications.filter(a => a.status === 'accepted').length;
                    this.applicationTabs[5].count = this.applications.filter(a => a.status === 'rejected').length;
                },

                get filteredApplications() {
                    if (this.activeApplicationTab === 'all') {
                        return this.applications;
                    }
                    return this.applications.filter(app => app.status === this.activeApplicationTab);
                },

                async loadStudents() {
                    try {
                        const params = new URLSearchParams({
                            status: this.studentStatusFilter,
                            search: this.studentSearch
                        });
                        if (this.studentClassFilter) {
                            params.append('class_id', this.studentClassFilter);
                        }

                        const response = await fetch(`/api/v1/admin/students/?${params}`, {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.students = data.data;
                            this.filteredStudents = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading students:', error);
                    }
                },

                filterStudents() {
                    this.filteredStudents = this.students.filter(student => {
                        const matchesSearch = !this.studentSearch ||
                            student.name.toLowerCase().includes(this.studentSearch.toLowerCase()) ||
                            student.student_id.toLowerCase().includes(this.studentSearch.toLowerCase());

                        const matchesClass = !this.studentClassFilter ||
                            student.class_id == this.studentClassFilter;

                        const matchesStatus = !this.studentStatusFilter ||
                            student.status === this.studentStatusFilter;

                        return matchesSearch && matchesClass && matchesStatus;
                    });
                },

                async viewStudent(student) {
                    try {
                        const response = await fetch(`/api/v1/admin/students/${student.id}/`, {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.selectedStudent = data.data;
                            this.showStudentModal = true;
                        }
                    } catch (error) {
                        console.error('Error loading student details:', error);
                    }
                },

                async loadTeachers() {
                    try {
                        const response = await fetch('/api/v1/teachers/manage/', {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.teachers = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading teachers:', error);
                    }
                },

                async loadAvailableData() {
                    try {
                        const [subjectsResp, classesResp] = await Promise.all([
                            fetch('/api/v1/teachers/subjects/', {
                                headers: { 'Authorization': `Bearer ${localStorage.getItem('access_token')}` }
                            }),
                            fetch('/api/v1/teachers/classes/', {
                                headers: { 'Authorization': `Bearer ${localStorage.getItem('access_token')}` }
                            })
                        ]);

                        const subjectsData = await subjectsResp.json();
                        const classesData = await classesResp.json();

                        if (subjectsData.success) this.availableSubjects = subjectsData.data;
                        if (classesData.success) this.availableClasses = classesData.data;

                    } catch (error) {
                        console.error('Error loading data:', error);
                    }
                },

                async saveTeacher() {
                    if (this.newTeacher.subjects.length === 0) {
                        alert('Please select at least one subject');
                        return;
                    }
                    if (this.newTeacher.classes.length === 0) {
                        alert('Please select at least one class');
                        return;
                    }

                    this.savingTeacher = true;

                    try {
                        const response = await fetch('/api/v1/teachers/manage/', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.newTeacher)
                        });

                        const data = await response.json();

                        if (data.success) {
                            alert(`Teacher added successfully!\n\nUsername: ${data.data.username}\nTemporary Password: ${data.data.temporary_password}\n\nPlease save these credentials and share with the teacher.`);
                            this.showAddTeacher = false;
                            this.resetTeacherForm();
                            await this.loadTeachers();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error saving teacher:', error);
                        alert('Error saving teacher');
                    } finally {
                        this.savingTeacher = false;
                    }
                },

                resetTeacherForm() {
                    this.newTeacher = {
                        first_name: '',
                        last_name: '',
                        email: '',
                        phone: '',
                        subjects: [],
                        classes: []
                    };
                },

                async deleteTeacher(teacherId) {
                    if (!confirm('Are you sure you want to remove this teacher?')) {
                        return;
                    }

                    try {
                        const response = await fetch(`/api/v1/teachers/manage/${teacherId}/`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });

                        const data = await response.json();

                        if (data.success) {
                            alert('Teacher removed successfully!');
                            await this.loadTeachers();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error deleting teacher:', error);
                        alert('Error deleting teacher');
                    }
                },

                async loadClasses() {
                    try {
                        const response = await fetch('/api/v1/admin/classes/', {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.classes = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading classes:', error);
                    }
                },

                async createClass() {
                    this.savingClass = true;

                    try {
                        const response = await fetch('/api/v1/admin/classes/', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.newClass)
                        });

                        const data = await response.json();

                        if (data.success) {
                            alert('Class created successfully!');
                            this.showCreateClass = false;
                            this.newClass = { name: '', capacity: 50, academic_year: '2024-2025' };
                            await this.loadClasses();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error creating class:', error);
                        alert('Error creating class');
                    } finally {
                        this.savingClass = false;
                    }
                },

                async loadFinanceData() {
                    try {
                        const response = await fetch('/api/v1/admin/finance/overview/', {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.financeData = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading finance data:', error);
                    }
                },

                async loadPendingFees() {
                    try {
                        const response = await fetch('/api/v1/admin/finance/pending-fees/', {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.pendingFeeStudents = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading pending fees:', error);
                    }
                },

                async recordPayment() {
                    if (!this.payment.student_id || !this.payment.amount) {
                        alert('Please fill in all required fields');
                        return;
                    }

                    this.processingPayment = true;

                    try {
                        const response = await fetch('/api/v1/admin/finance/record-payment/', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.payment)
                        });

                        const data = await response.json();

                        if (data.success) {
                            alert(`Payment recorded successfully!\n\nReceipt Number: ${data.data.receipt_number}\nAmount: GHS ${data.data.amount}\nBalance: GHS ${data.data.balance}`);
                            this.payment = { student_id: '', amount: '', payment_method: 'cash', reference: '' };
                            await this.loadFinanceData();
                            await this.loadPendingFees();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error recording payment:', error);
                        alert('Error recording payment');
                    } finally {
                        this.processingPayment = false;
                    }
                },

                async loadTeacherPerformance() {
                    try {
                        const response = await fetch('/api/v1/admin/reports/teacher-performance/', {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.teacherPerformance = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading teacher performance:', error);
                    }
                },

                async loadSettings() {
                    try {
                        const response = await fetch('/api/v1/admin/settings/', {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.settings = { ...this.settings, ...data.data };
                        }
                    } catch (error) {
                        console.error('Error loading settings:', error);
                    }
                },

                async saveSchoolSettings() {
                    this.savingSettings = true;

                    try {
                        const response = await fetch('/api/v1/admin/settings/', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.settings)
                        });

                        const data = await response.json();

                        if (data.success) {
                            alert('Settings saved successfully!');
                        } else {
                            alert('Error: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error saving settings:', error);
                        alert('Error saving settings');
                    } finally {
                        this.savingSettings = false;
                    }
                },

                saveAcademicSettings() {
                    return this.saveSchoolSettings();
                },

                async loadTimeSlots() {
                    try {
                        const response = await fetch('/api/v1/admin/timetable/time-slots/', {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.timeSlots = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading time slots:', error);
                    }
                },

                async loadClassTimetable() {
                    if (!this.selectedTimetableClass) return;

                    try {
                        const response = await fetch(`/api/v1/admin/timetable/class/${this.selectedTimetableClass}/`, {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.classTimetable = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading class timetable:', error);
                    }
                },

                async createTimetable() {
                    if (!this.newTimetable.class_id) {
                        alert('Please select a class');
                        return;
                    }

                    this.savingTimetable = true;

                    try {
                        const response = await fetch('/api/v1/admin/timetable/create/', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.newTimetable)
                        });

                        const data = await response.json();

                        if (data.success) {
                            alert('Timetable created successfully!');
                            this.showCreateTimetable = false;
                            this.newTimetable = { class_id: '', academic_year: '2024-2025', term: 'first' };
                            this.selectedTimetableClass = data.data.class_id;
                            await this.loadClassTimetable();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error creating timetable:', error);
                        alert('Error creating timetable');
                    } finally {
                        this.savingTimetable = false;
                    }
                },

                addTimetableEntry(timeSlot, day) {
                    this.timetableEntry = {
                        id: null,
                        time_slot_id: timeSlot,
                        day_of_week: day,
                        subject_id: '',
                        teacher_id: '',
                        room_number: ''
                    };
                    this.showTimetableEntryModal = true;
                },

                editTimetableEntry(entry) {
                    if (entry) {
                        this.timetableEntry = { ...entry };
                    } else {
                        this.timetableEntry = {
                            id: null,
                            time_slot_id: '',
                            day_of_week: '',
                            subject_id: '',
                            teacher_id: '',
                            room_number: ''
                        };
                    }
                    this.showTimetableEntryModal = true;
                },


                async loadTimeSlots() {
                    try {
                        const response = await fetch('/api/v1/admin/timetable/time-slots/', {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.timeSlots = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading time slots:', error);
                    }
                },

                async loadClassTimetable() {
                    if (!this.selectedTimetableClass) return;

                    try {
                        const response = await fetch(`/api/v1/admin/timetable/class/${this.selectedTimetableClass}/`, {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.classTimetable = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading class timetable:', error);
                    }
                },

                async loadTimeSlots() {
                    try {
                        const response = await fetch('/api/v1/admin/timetable/time-slots/', {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.timeSlots = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading time slots:', error);
                    }
                },

                async loadClassTimetable() {
                    if (!this.selectedTimetableClass) return;

                    try {
                        const response = await fetch(`/api/v1/admin/timetable/class/${this.selectedTimetableClass}/`, {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.classTimetable = data.data;
                        }
                    } catch (error) {
                        console.error('Error loading class timetable:', error);
                    }
                },

                async createTimetable() {
                    if (!this.newTimetable.class_id) {
                        alert('Please select a class');
                        return;
                    }

                    this.savingTimetable = true;

                    try {
                        const response = await fetch('/api/v1/admin/timetable/create/', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.newTimetable)
                        });

                        const data = await response.json();

                        if (data.success) {
                            alert('Timetable created successfully!');
                            this.showCreateTimetable = false;
                            this.newTimetable = { class_id: '', academic_year: '2024-2025', term: 'first' };
                            this.selectedTimetableClass = data.data.class_id;
                            await this.loadClassTimetable();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error creating timetable:', error);
                        alert('Error creating timetable');
                    } finally {
                        this.savingTimetable = false;
                    }
                },

                addTimetableEntry(timeSlot, day) {
                    this.timetableEntry = {
                        id: null,
                        time_slot_id: timeSlot,
                        day_of_week: day,
                        subject_id: '',
                        teacher_id: '',
                        room_number: ''
                    };
                    this.showTimetableEntryModal = true;
                },

                editTimetableEntry(entry) {
                    if (entry) {
                        this.timetableEntry = { ...entry };
                    } else {
                        this.timetableEntry = {
                            id: null,
                            time_slot_id: '',
                            day_of_week: '',
                            subject_id: '',
                            teacher_id: '',
                            room_number: ''
                        };
                    }
                    this.showTimetableEntryModal = true;
                },

                async saveTimetableEntry() {
                    // Validate required fields
                    if (!this.newTimetableEntry.day_of_week || !this.newTimetableEntry.time_slot ||
                        !this.newTimetableEntry.subject_id || !this.newTimetableEntry.teacher_id) {
                        alert('Please fill in all required fields (Day, Time, Subject, and Teacher are required)');
                        return;
                    }

                    if (!this.selectedTimetableClass) {
                        alert('Please select a class first');
                        return;
                    }

                    this.savingTimetable = true;

                    try {
                        const url = this.editingTimetableEntry
                            ? `/api/v1/admin/timetable/entry/${this.editingTimetableEntry.id}/`
                            : '/api/v1/admin/timetable/entry/';

                        const method = this.editingTimetableEntry ? 'PUT' : 'POST';

                        const response = await fetch(url, {
                            method: method,
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                class_id: this.selectedTimetableClass,
                                day_of_week: this.newTimetableEntry.day_of_week,
                                time_slot: this.newTimetableEntry.time_slot,
                                subject_id: this.newTimetableEntry.subject_id,
                                teacher_id: this.newTimetableEntry.teacher_id,
                                room_number: this.newTimetableEntry.room_number || ''
                            })
                        });

                        const data = await response.json();

                        if (data.success) {
                            alert(this.editingTimetableEntry ? 'Timetable entry updated!' : 'Timetable entry added!');
                            this.showAddTimetableEntry = false;
                            this.resetTimetableForm();
                            await this.loadTimetable();
                        } else {
                            alert('Error: ' + (data.error || 'Failed to save timetable entry'));
                        }
                    } catch (error) {
                        console.error('Error saving timetable entry:', error);
                        alert('Network error: Could not save timetable entry. Check console for details.');
                    } finally {
                        this.savingTimetable = false;
                    }
                },

                async deleteTimetableEntry() {
                    if (!confirm('Are you sure you want to delete this entry?')) {
                        return;
                    }

                    try {
                        const response = await fetch(`/api/v1/admin/timetable/entry/${this.timetableEntry.id}/delete/`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            }
                        });

                        const data = await response.json();

                        if (data.success) {
                            alert('Entry deleted successfully!');
                            this.showTimetableEntryModal = false;
                            await this.loadClassTimetable();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error deleting entry:', error);
                        alert('Error deleting entry');
                    }
                },

                initCharts() {
                    if (this.stats.applications) {
                        const ctx1 = document.getElementById('applicationsChart');
                        if (ctx1) {
                            new Chart(ctx1, {
                                type: 'doughnut',
                                data: {
                                    labels: ['Pending', 'Under Review', 'Exam Completed', 'Accepted', 'Rejected'],
                                    datasets: [{
                                        data: [
                                            this.stats.applications.pending_review || 0,
                                            this.stats.applications.under_review || 0,
                                            this.stats.applications.exam_completed || 0,
                                            this.stats.applications.accepted || 0,
                                            this.stats.applications.rejected || 0
                                        ],
                                        backgroundColor: ['#f59e0b', '#3b82f6', '#8b5cf6', '#10b981', '#ef4444']
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: true
                                }
                            });
                        }
                    }

                    if (this.stats.classes && this.stats.classes.length > 0) {
                        const ctx2 = document.getElementById('classCapacityChart');
                        if (ctx2) {
                            new Chart(ctx2, {
                                type: 'bar',
                                data: {
                                    labels: this.stats.classes.map(c => c.class_name),
                                    datasets: [{
                                        label: 'Enrolled',
                                        data: this.stats.classes.map(c => c.enrolled),
                                        backgroundColor: '#6366f1'
                                    }, {
                                        label: 'Capacity',
                                        data: this.stats.classes.map(c => c.capacity),
                                        backgroundColor: '#e5e7eb'
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: true
                                }
                            });
                        }
                    }
                },

                handleQuickAction(action) {
                    if (action.title.includes('Applications')) {
                        this.currentView = 'applications';
                        this.activeApplicationTab = 'pending';
                    } else if (action.title.includes('Admissions')) {
                        this.currentView = 'applications';
                        this.activeApplicationTab = 'exam_completed';
                    }
                },

                async acceptApplication(app) {
                    // Show available classes with more details
                    let classOptions = 'Available Classes:\n\n';
                    this.availableClasses.forEach(cls => {
                        classOptions += `ID: ${cls.id} - ${cls.name} (${cls.capacity} capacity)\n`;
                    });
                    classOptions += '\nEnter the Class ID number:';

                    const classId = prompt(classOptions);
                    if (!classId) return;

                    console.log('🔄 Starting enrollment process...');
                    console.log('Application:', app.application_number);
                    console.log('Class ID:', classId);

                    try {
                        const response = await fetch(`/api/v1/admin/admissions/applications/${app.application_number}/enroll/`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ class_id: classId })
                        });

                        const data = await response.json();
                        console.log('📥 Enrollment response:', data);

                        if (data.success) {
                            const isNewParent = data.data.parent_password !== 'Existing parent - no new password';

                            let message = `✅ STUDENT ENROLLED SUCCESSFULLY!\n\n`;
                            message += `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n`;
                            message += `STUDENT CREDENTIALS:\n`;
                            message += `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n`;
                            message += `Student ID: ${data.data.student_id}\n`;
                            message += `Username: ${data.data.student_username}\n`;
                            message += `Password: ${data.data.student_password}\n`;
                            message += `Class: ${data.data.class}\n\n`;

                            message += `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n`;
                            message += `PARENT CREDENTIALS:\n`;
                            message += `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n`;
                            message += `Username: ${data.data.parent_username}\n`;

                            if (isNewParent) {
                                message += `Password: ${data.data.parent_password}\n`;
                                message += `📧 NEW parent account created\n\n`;
                            } else {
                                message += `🔗 EXISTING parent account\n`;
                                message += `(Parent already had an account)\n\n`;
                            }

                            message += `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n`;
                            message += `📧 Credentials sent to: ${app.parent_email}\n`;
                            message += `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n`;
                            message += `⚠️  IMPORTANT: Save these credentials!\n`;
                            message += `They will not be shown again.`;

                            alert(message);

                            // Reload data
                            await Promise.all([
                                this.loadApplications(),
                                this.loadStudents(),
                                this.loadClasses(),
                                this.loadDashboardData()
                            ]);

                            console.log('✅ All data reloaded successfully');
                        } else {
                            alert('❌ ENROLLMENT FAILED\n\nError: ' + data.error);
                            console.error('Enrollment error:', data.error);
                        }
                    } catch (error) {
                        console.error('❌ Enrollment request failed:', error);
                        alert('❌ NETWORK ERROR\n\nFailed to connect to server.\nCheck console for details.');
                    }
                },

                async rejectApplication(app) {
                    const reason = prompt('Enter rejection reason:');
                    if (!reason) return;

                    try {
                        const response = await fetch(`/api/v1/admin/admissions/applications/${app.application_number}/status/`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                status: 'rejected',
                                admin_notes: reason
                            })
                        });

                        const data = await response.json();

                        if (data.success) {
                            alert('Application rejected');
                            await this.loadApplications();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error rejecting application:', error);
                        alert('Error rejecting application');
                    }
                },

                viewApplication(app) {
                    alert(`Application Details:\n\nApplication #: ${app.application_number}\nName: ${app.learner_name}\nClass: ${app.applying_for_class}\nStatus: ${app.status}\n\nView full details in Django Admin for now.`);
                },

                viewClassStudents(cls) {
                    this.currentView = 'students';
                    this.studentClassFilter = cls.id;
                    this.filterStudents();
                },

                editStudent(student) {
                    alert('Edit student functionality - coming soon');
                },

                editTeacher(teacher) {
                    alert('Edit teacher functionality - coming soon');
                },

                generateReport(type) {
                    alert(`Generating ${type} report... This feature will download a comprehensive ${type} report.`);
                },

                formatDate(dateString) {
                    if (!dateString) return 'N/A';
                    const date = new Date(dateString);
                    return date.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                },

                logout() {
                    if (confirm('Are you sure you want to logout?')) {
                        localStorage.removeItem('access_token');
                        localStorage.removeItem('refresh_token');
                        localStorage.removeItem('user_data');
                        window.location.href = '/auth/';
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] {
            display: none !important;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</body>

</html>