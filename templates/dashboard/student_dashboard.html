<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Academic Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .action-card {
            transition: all 0.2s ease-in-out;
        }
        .action-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen" x-data="studentDashboard()" x-init="init()">
    
    <!-- Custom Message Box (Replaces alert()) -->
    <div x-show="message.show" x-transition.opacity
        :class="{
            'bg-green-100 border-green-400 text-green-700': message.type === 'success',
            'bg-yellow-100 border-yellow-400 text-yellow-700': message.type === 'warning',
            'bg-red-100 border-red-400 text-red-700': message.type === 'error',
            'bg-blue-100 border-blue-400 text-blue-700': message.type === 'info',
        }"
        class="fixed top-4 right-4 z-50 p-4 rounded-lg shadow-xl border-l-4"
        style="min-width: 300px;"
        @click="message.show = false">
        <div class="flex justify-between items-center">
            <p x-text="message.text" class="font-medium"></p>
            <button class="ml-4 text-xl font-bold text-gray-500 hover:text-gray-700 leading-none">&times;</button>
        </div>
    </div>

    <!-- Header & Profile Dropdown -->
    <nav class="bg-white shadow-lg z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <i class="fas fa-graduation-cap text-2xl text-blue-600 mr-3"></i>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">Excellence Academy</h1>
                        <p class="text-xs text-gray-600">Student Portal</p>
                    </div>
                </div>
                
                <!-- Profile Section -->
                <div class="relative" x-cloak>
                    <button @click="isProfileOpen = !isProfileOpen" class="flex items-center space-x-2 focus:outline-none p-2 rounded-full hover:bg-gray-100 transition">
                        <img :src="user?.profile_picture_url" alt="Profile" class="h-10 w-10 rounded-full object-cover border-2 border-blue-500">
                        <span class="hidden sm:inline text-sm font-semibold text-gray-700" x-text="user?.first_name"></span>
                        <i class="fas fa-chevron-down text-gray-400 text-xs hidden sm:block" :class="{'transform rotate-180': isProfileOpen}"></i>
                    </button>

                    <!-- Profile Dropdown Menu -->
                    <div x-show="isProfileOpen" @click.outside="isProfileOpen = false"
                         x-transition:enter="transition ease-out duration-100"
                         x-transition:enter-start="transform opacity-0 scale-95"
                         x-transition:enter-end="transform opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-75"
                         x-transition:leave-start="transform opacity-100 scale-100"
                         x-transition:leave-end="transform opacity-0 scale-95"
                         class="absolute right-0 mt-2 w-72 origin-top-right bg-white border border-gray-200 divide-y divide-gray-100 rounded-lg shadow-xl z-20"
                         role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button" tabindex="-1">
                        <div class="p-4">
                            <div class="flex items-center space-x-3 border-b pb-3">
                                <img :src="user?.profile_picture_url" alt="Profile" class="h-12 w-12 rounded-full object-cover border border-gray-200">
                                <div>
                                    <p class="text-base font-bold text-gray-900" x-text="user?.first_name + ' ' + user?.last_name"></p>
                                    <p class="text-xs text-blue-600 font-medium">Student Profile</p>
                                </div>
                            </div>
                            <div class="mt-4 space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="font-medium text-gray-600"><i class="fas fa-fingerprint mr-2 text-blue-400"></i>Student ID:</span>
                                    <span class="text-gray-900 font-mono" x-text="user?.student_id"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-medium text-gray-600"><i class="fas fa-graduation-cap mr-2 text-blue-400"></i>Class:</span>
                                    <span class="text-gray-900 font-medium" x-text="user?.class_name"></span>
                                </div>
                            </div>
                        </div>
                        <div class="py-1">
                            <button @click="logout(); isProfileOpen = false;" class="w-full text-left flex items-center px-4 py-3 text-sm text-red-600 hover:bg-red-50 hover:text-red-700 transition duration-150 ease-in-out">
                                <i class="fas fa-sign-out-alt mr-3"></i>
                                Logout
                            </button>
                        </div>
                    </div>
                </div>
                <!-- End Profile Section -->
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Welcome Section -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-xl shadow-xl p-8 text-white mb-8">
            <h2 class="text-3xl font-bold mb-1">
                Welcome back, <span x-text="user?.first_name"></span>!
            </h2>
            <p class="text-blue-100 text-lg">Manage your academics and stay on track.</p>
        </div>

        <!-- Key Actions Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Download Timetable -->
            <div @click="downloadTimetable()" class="action-card bg-white rounded-xl shadow-lg p-6 cursor-pointer border-t-4 border-yellow-500 hover:border-yellow-600">
                <i class="fas fa-calendar-alt text-4xl text-yellow-500 mb-3"></i>
                <h3 class="text-lg font-bold text-gray-900">Download Timetable</h3>
                <p class="text-sm text-gray-600">Get your latest weekly schedule.</p>
            </div>
            
            <!-- Assignment Upload -->
            <div class="bg-white rounded-xl shadow-lg p-6 border-t-4 border-purple-500">
                <i class="fas fa-upload text-4xl text-purple-500 mb-3"></i>
                <h3 class="text-lg font-bold text-gray-900">Upload Assignment</h3>
                <!-- Simple upload form trigger -->
                <button @click="$refs.uploadModal.show = true" class="mt-2 w-full text-sm font-medium bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700 transition">
                    Start Upload
                </button>
            </div>

            <!-- Check Marks/Grades -->
            <div class="action-card bg-white rounded-xl shadow-lg p-6 cursor-pointer border-t-4 border-green-500 hover:border-green-600" @click="showMessage('Navigating to Grades View...', 'info')">
                <i class="fas fa-clipboard-check text-4xl text-green-500 mb-3"></i>
                <h3 class="text-lg font-bold text-gray-900">Check Marks</h3>
                <p class="text-sm text-gray-600">View latest test and exam scores.</p>
            </div>

            <!-- View All Courses (End of Semester Review) -->
            <div class="action-card bg-white rounded-xl shadow-lg p-6 cursor-pointer border-t-4 border-blue-500 hover:border-blue-600" @click="showMessage('Viewing detailed academic record...', 'info')">
                <i class="fas fa-tasks text-4xl text-blue-500 mb-3"></i>
                <h3 class="text-lg font-bold text-gray-900">Academic Review</h3>
                <p class="text-sm text-gray-600">Check all current & past courses.</p>
            </div>
        </div>

        <!-- Detailed Views (Assignments & Courses) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Upcoming Assignments -->
            <div class="bg-white rounded-xl shadow-lg">
                <div class="p-6 border-b bg-gray-50 rounded-t-xl">
                    <h3 class="text-xl font-bold text-gray-900">
                        <i class="fas fa-hourglass-half mr-2 text-red-600"></i>Pending Deadlines
                    </h3>
                </div>
                <div class="p-6 space-y-4">
                    <template x-for="assignment in assignments" :key="assignment.id">
                        <div class="p-4 rounded-lg transition duration-150 ease-in-out" 
                             :class="{
                                'bg-red-50 border-l-4 border-red-500': assignment.urgency === 'High',
                                'bg-yellow-50 border-l-4 border-yellow-500': assignment.urgency === 'Medium',
                                'bg-blue-50 border-l-4 border-blue-500': assignment.urgency === 'Low'
                             }">
                            <div class="flex justify-between items-center">
                                <h4 class="font-bold text-gray-900" x-text="assignment.name"></h4>
                                <span class="text-xs font-semibold px-2 py-1 rounded-full"
                                      :class="{
                                          'bg-red-200 text-red-800': assignment.urgency === 'High',
                                          'bg-yellow-200 text-yellow-800': assignment.urgency === 'Medium',
                                          'bg-blue-200 text-blue-800': assignment.urgency === 'Low'
                                      }"
                                      x-text="assignment.urgency"></span>
                            </div>
                            <p class="text-sm text-gray-600 mt-1" x-text="'Course: ' + assignment.course"></p>
                            <p class="text-sm text-gray-600" x-text="'Due: ' + assignment.due"></p>
                        </div>
                    </template>
                </div>
            </div>

            <!-- My Current Grades/Marks -->
            <div class="bg-white rounded-xl shadow-lg">
                <div class="p-6 border-b bg-gray-50 rounded-t-xl">
                    <h3 class="text-xl font-bold text-gray-900">
                        <i class="fas fa-calculator mr-2 text-green-600"></i>Recent Marks
                    </h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <template x-for="grade in grades" :key="grade.id">
                            <div class="p-3 border rounded-lg bg-white">
                                <div class="flex justify-between items-center">
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900" x-text="grade.subject + ' - ' + grade.test"></h4>
                                        <p class="text-xs text-gray-500" x-text="'Date: ' + grade.date"></p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-2xl font-extrabold"
                                           :class="{'text-green-600': grade.score >= 80, 'text-yellow-600': grade.score < 80 && grade.score >= 60, 'text-red-600': grade.score < 60}"
                                           x-text="grade.score + '%'"></p>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <!-- Assignment Upload Modal -->
    <div x-ref="uploadModal" x-data="{ show: false, selectedCourse: '', assignmentName: '', file: null }" 
         @modal.window="show = $event.detail.show"
         x-show="show" 
         x-transition:enter="ease-out duration-300" 
         x-transition:enter-start="opacity-0" 
         x-transition:enter-end="opacity-100" 
         x-transition:leave="ease-in duration-200" 
         x-transition:leave-start="opacity-100" 
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-gray-900 bg-opacity-75 z-30 flex items-center justify-center p-4" 
         style="display: none;">
        
        <div @click.outside="show = false" 
             x-transition:enter="ease-out duration-300" 
             x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" 
             x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100" 
             x-transition:leave="ease-in duration-200" 
             x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100" 
             x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
             class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg">
            
            <h3 class="text-2xl font-bold text-gray-900 mb-4 flex items-center"><i class="fas fa-file-upload mr-3 text-purple-600"></i>Submit Assignment</h3>
            
            <div class="space-y-4">
                <!-- Course Selection -->
                <div>
                    <label for="course-select" class="block text-sm font-medium text-gray-700">Select Course</label>
                    <select id="course-select" x-model="selectedCourse" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm rounded-lg">
                        <option value="" disabled>Choose a course...</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Science">Science</option>
                        <option value="English">English</option>
                    </select>
                </div>

                <!-- Assignment Name -->
                <div>
                    <label for="assignment-name" class="block text-sm font-medium text-gray-700">Assignment Name</label>
                    <input type="text" id="assignment-name" x-model="assignmentName" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-2 focus:ring-purple-500 focus:border-purple-500 sm:text-sm" placeholder="e.g., Chapter 5 Review">
                </div>

                <!-- File Input -->
                <div>
                    <label for="assignment_file_upload" class="block text-sm font-medium text-gray-700">Upload File</label>
                    <input type="file" id="assignment_file_upload" @change="file = $event.target.files[0]; $store.dashboard.handleAssignmentFile($event)" class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100">
                    <p class="mt-1 text-xs text-gray-500" x-text="file ? 'Selected: ' + file.name : 'Max file size 10MB (PDF, DOCX, JPG)'"></p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="mt-6 flex justify-end space-x-3">
                <button @click="show = false" type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition">
                    Cancel
                </button>
                <button @click="$store.dashboard.uploadAssignment(selectedCourse, assignmentName); show = false; selectedCourse = ''; assignmentName = ''; file = null;" 
                        :disabled="!selectedCourse || !assignmentName || !file"
                        type="button" 
                        class="px-4 py-2 text-sm font-medium text-white bg-purple-600 rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed">
                    Submit
                </button>
            </div>
        </div>
    </div>


    <script>
        function studentDashboard() {
            return {
                // Mock Student Data (Replace with real data fetch in a full environment)
                user: {
                    first_name: "Kwame",
                    last_name: "Mensah",
                    student_id: "SCHL100234",
                    class_name: "10B - Science",
                    // Placeholder image URL
                    profile_picture_url: "https://placehold.co/100x100/4c51bf/ffffff?text=KM",
                },
                
                // Mock Data for Assignments and Grades
                assignments: [
                    { id: 1, name: "Math Chapter 5 Problems", course: "Mathematics", due: "Oct 5, 2025", urgency: "High" },
                    { id: 2, name: "Solar System Model", course: "Science", due: "Oct 8, 2025", urgency: "Medium" },
                    { id: 3, name: "Book Review Essay", course: "English", due: "Oct 12, 2025", urgency: "Low" },
                ],
                grades: [
                    { id: 1, subject: "Mathematics", test: "Mid-Term Quiz", score: 88, date: "Sep 25, 2025" },
                    { id: 2, subject: "Science", test: "Lab Report 3", score: 95, date: "Sep 20, 2025" },
                    { id: 3, subject: "English", test: "Vocabulary Test", score: 65, date: "Sep 18, 2025" },
                ],

                // Alpine State
                isProfileOpen: false,
                message: { show: false, text: '', type: 'info' }, // Custom message box state
                assignmentFile: null,

                init() {
                    // Initialize Alpine Store for modal access
                    this.$store.dashboard = this;
                    console.log('Student Dashboard Initialized for user:', this.user.student_id);
                },

                /**
                 * Custom message handler (replaces alert())
                 * @param {string} text - The message content.
                 * @param {string} type - 'success', 'warning', 'error', 'info'.
                 */
                showMessage(text, type = 'info') {
                    this.message = { show: true, text: text, type: type };
                    setTimeout(() => {
                        this.message.show = false;
                    }, 4000);
                },

                // 1. Download Timetable Feature
                downloadTimetable() {
                    this.showMessage('Timetable file (mock-2025-2026.pdf) is downloading...', 'success');
                    // In a real application, this would trigger an actual file download.
                    console.log('Action: Downloading Timetable');
                },

                // 2. Assignment Upload - Handle file selection
                handleAssignmentFile(event) {
                    this.assignmentFile = event.target.files[0];
                },

                // 2. Assignment Upload - Mock upload process
                uploadAssignment(course, assignmentName) {
                    if (!this.assignmentFile) {
                        this.showMessage('Upload failed. Please select a file.', 'error');
                        return;
                    }

                    if (!course || !assignmentName) {
                         this.showMessage('Upload failed. Please select a course and provide an assignment name.', 'error');
                        return;
                    }

                    // Simulated upload process
                    this.showMessage(`Preparing to submit assignment for ${course}...`, 'info');

                    setTimeout(() => {
                        this.showMessage(`'${this.assignmentFile.name}' successfully uploaded for ${course}: ${assignmentName}.`, 'success');
                        this.assignmentFile = null;
                        console.log('Mock Upload Complete:', course, assignmentName);
                    }, 1800);
                },

                // 5. Profile & Logout Feature
                logout() {
                    this.isProfileOpen = false;
                    this.showMessage('Logging out now. Come back soon!', 'warning');
                    // In a real application, this would clear authentication tokens and redirect the user.
                    setTimeout(() => {
                        console.log('Mock Logout completed. (No redirect in this demo file)');
                    }, 1000);
                }
            }
        }
    </script>
</body>
</html>
 